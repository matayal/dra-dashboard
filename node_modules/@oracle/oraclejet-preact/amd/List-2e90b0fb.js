define(["exports","preact/jsx-runtime","preact/hooks",'module',"./utils/UNSAFE_classNames","./utils/UNSAFE_mergeProps","./utils/UNSAFE_keys","./LoadMoreCollection-afedb694","./PRIVATE_VirtualizedCollection","./hooks/UNSAFE_useTabbableMode","./UNSAFE_FocusTrap","./hooks/UNSAFE_useId","./classNames-b7cf3c05","./FocusTrap-d4cc44b1","./hooks/PRIVATE_useSelection","./hooks/PRIVATE_useCurrentKey","./hooks/PRIVATE_useCollectionFocusRing","./hooks/PRIVATE_useTabbableModeSet","./hooks/PRIVATE_useItemAction","./UNSAFE_Skeleton","./UNSAFE_Flex","./utils/PRIVATE_collectionUtils","./UNSAFE_Selector","./VirtualizedCollection-79996ea9","./Flex-b68a7b84","./Skeleton-b8b725eb"],function(e,t,i,n,s,o,l,r,a,c,u,d,g,b,m,f,v,y,x,h,p,k,S,j,A,C){"use strict";const E=e=>{switch(e){case"listbox":return{list:"listbox",item:"presentation",cell:"option"};case"treegrid":return{list:"treegrid",item:"row",cell:"gridcell"};default:return{list:"grid",item:"row",cell:"gridcell"}}},T="oj-listview-item",_=".oj-listview-item",w="_4l8v7t",F="_14kiway",R="r3fr13",I="ovypdr",K="_1hcz5g5",P="_4b8won",V="_10kz96g",z="iqsi5d",N="_1jmlya9",M="_74pqfh",O="iyhli7";function U({children:e,itemKey:n,itemIndex:s,isFocused:o,isFocusRingVisible:l,isGridlineVisible:r,isSelected:a,isTopGridlineVisible:u=!1,isTabbable:m=!1,role:f,selectionMode:v,suggestion:y,currentItemVariant:x}){const h=i.useRef(null),p=i.useMemo(()=>E(f),[f]),k="option"===p.cell?{role:p.cell,"aria-posinset":s+1,"aria-setsize":-1}:{role:p.cell},S=g.classNames([w,T,o&&l&&N,r&&F,u&&R,L(v,a)&&!a&&I,a&&K,a&&"single"===v&&P,"end"===y&&!r&&!(a&&"single"===v)&&V,"highlight"===x&&o&&!a&&z]),j=g.classNames([M,"multiple"===v&&O]);return t.jsx("div",Object.assign({"aria-rowindex":s+1,"data-oj-key":n,class:S,ref:h,role:p.item},y&&{"data-oj-suggestion":!0},"number"==typeof n&&{"data-oj-key-type":"number"},{children:t.jsx("div",Object.assign({id:d.useId(),class:j,"aria-posinset":s+1,"aria-setsize":-1,onKeyDown:e=>{!m||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.stopPropagation()},"aria-colindex":1,"aria-selected":"none"!==v?a:void 0},k,{children:t.jsx(c.TabbableModeContext.Provider,Object.assign({value:{isTabbable:m}},{children:t.jsx(b.FocusTrap,Object.assign({isDisabled:!m,restoreFocusRef:!1},{children:e}))}))}))}))}const L=(e,t)=>"none"!==e&&("multiple"===e||!t),D="mms8za";function q({children:e,minimumCount:n=1}){const[s,o]=i.useState(!1);i.useEffect(()=>{setTimeout(()=>{o(!0)},50)},[]);const l=g.classNames([D]);return s&&e?t.jsx("div",Object.assign({class:l,role:"presentation"},{children:[...Array(n)].map((t,i)=>e(i))})):null}const H="_10d0tgu",B="_1hwssza",G="_14h04o3";const Y=e=>{const t=null==e?void 0:e.data,i=$(t);if(0===i)return null;return t.slice(0,i).reduce((e,t,n)=>{const s=t.metadata.key;return n===i-1?e.set(s,"end"):e.set(s,!0),e},new Map)},$=e=>{if(!e)return 0;const t=e.findIndex(e=>!e.metadata.suggestion);return-1===t?0:t},J=(e,t)=>{if(e&&t){const i=t.getBoundingClientRect(),n=e.getBoundingClientRect();n.bottom>i.bottom?t.scrollTop=t.scrollTop+(n.bottom-i.bottom):n.top<i.top&&(t.scrollTop=t.scrollTop-(i.top-n.top))}},Q=(e,t)=>null!=t?t:{scroller:()=>e.current},W={all:!1,keys:new Set},X=(e,t)=>{const i=t.data.map(e=>e.metadata.key),n=i.indexOf(e.value.start),s=i.indexOf(e.value.end),o=Math.min(n,s),l=Math.max(n,s);return-1===o?{offset:0,count:t.totalSize}:i.slice(o,l+1)};function Z({sparkleHeight:e}){if(e<=0)return null;const i=e+"px",n=g.classNames([B]),s=g.classNames([G]);return t.jsx("div",Object.assign({class:s},{children:t.jsx("div",{class:n,style:{height:i}})}),"sparkle")}const ee=t.jsx(q,Object.assign({minimumCount:25},{children:()=>t.jsx(A.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(C.Skeleton,{height:"4x"})}))})),te=t.jsx(q,Object.assign({minimumCount:3},{children:()=>t.jsx(A.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(C.Skeleton,{height:"4x"})}))})),ie=(e,t)=>{if(t){const i=Math.min(t.offset,e.offset+e.totalSize),n=i-e.offset;n>0&&(e={offset:i,data:e.data.slice(n,n+t.count),totalSize:e.totalSize,sizePrecision:e.sizePrecision})}return e};e.List=function({accessibleSummary:e,allowTabbableMode:n=!0,children:s,currentKey:a,data:c,gridlines:u,loadingIndicator:d=ee,onCurrentKeyChange:b,onLoadRange:h,onSelectionChange:p,onItemAction:A,rangeExtractor:C,role:T="grid",selectedKeys:w=W,selectionMode:F="none",viewportConfig:R,currentItemVariant:I="none",isVirtualized:K=!0}){const P=i.useRef(null),V=i.useMemo(()=>E(T),[T]),z=i.useRef(),N=i.useRef(),M=i.useRef(),[O,L]=i.useState(0),D="none"===F?void 0:"multiple"===F,q=null===c?void 0:"exact"===c.sizePrecision?c.totalSize:-1,B=g.classNames([H]),{currentKeyProps:G}=f.useCurrentKey(e=>k.keyExtractor(e,_),k.getPrevNextKey(P.current,a,!0,_),k.getPrevNextKey(P.current,a,!1,_),a,b),$=e=>{var t;return!!(null===(t=P.current)||void 0===t?void 0:t.contains(e))},[ne,se]=v.useCollectionFocusRing($,["ArrowUp","ArrowDown"]);let oe=!1;const[le,re]=y.useTabbableModeSet($,e=>k.keyExtractor(e,_),a,(e,t)=>{var i;(null===e||$(e))&&(t?(oe=!0,setTimeout(()=>{var e;null===(e=P.current)||void 0===e||e.focus()},0)):null===(i=P.current)||void 0===i||i.focus())},e=>{b&&b({value:e})});i.useEffect(()=>{if(null!=a&&P.current){const e=k.findElementByKey(P.current,a,_);if(e){const t=null==R?void 0:R.scroller();J(e,null!=t?t:P.current);const i=e.querySelector(`[role=${V.cell}]`);i&&P.current.setAttribute("aria-activedescendant",i.id)}}},[a,c,V.cell,R]);const ae=i.useCallback(e=>{p&&(!1===e.value.all&&e.value.keys.size>0&&(z.current=Array.from(e.value.keys.values()).pop()),p(e))},[z,p]),ce=i.useCallback(e=>{if(c&&p){const t=X(e,c);Array.isArray(t)?p({value:{all:!1,keys:new Set(t)},target:null}):(N.current={detail:e,range:{offset:c.offset,count:c.data.length}},h(t))}},[c,p,h]),ue=i.useCallback(()=>{if(P.current&&b&&(!n||le(void 0))){const e=M.current||k.getFirstVisibleKey(P.current,_);l.isKeyDefined(e)&&b({value:e})}},[n,b,le]),de=i.useCallback(e=>{var t,i;const n=k.keyExtractor(e.target,_);n&&"checkbox"===(null===(t=e.relatedTarget)||void 0===t?void 0:t.getAttribute("type"))&&(null===(i=P.current)||void 0===i||i.focus(),b&&n&&b({value:n}))},[b]),ge=i.useCallback(e=>{!l.isKeyDefined(a)&&b&&ue(),!n&&de(e)},[n,a,ue,de,b]),{selectionProps:be}=m.useSelection(e=>e===P.current?void 0===a?null:a:k.keyExtractor(e,_),w,F,!1,"replace",ae,z.current,a,(e,t)=>k.getPrevNextKey(P.current,e,t,_),e=>{if(P.current){const t=k.findElementByKey(P.current,e,_);if(t){const e=null==R?void 0:R.scroller();J(t,null!=e?e:P.current)}}},ce);if(c&&void 0!==N.current&&p){const e=X(N.current.detail,c);Array.isArray(e)&&p({value:{all:!1,keys:new Set(e)},target:null});const t=N.current?N.current.range:{offset:c.offset,count:c.data.length};c=ie(c,t),N.current=void 0,h(t)}const me=i.useMemo(()=>Y(c),[c]),fe=t.jsx(Z,{sparkleHeight:O}),ve=x.useItemAction(a,c,A,_);i.useEffect(()=>{var e,t;if(me){const i=null===(e=P.current)||void 0===e?void 0:e.querySelector("."+j.PLACEHOLDER_STYLE_CLASS);let n=(null==i?void 0:i.offsetHeight)||0;const s=null===(t=P.current)||void 0===t?void 0:t.querySelectorAll("[data-oj-suggestion]");null==s||s.forEach(e=>n+=e.offsetHeight),L(n)}},[me]);const ye=i.useCallback(e=>{const i="multiple"===F?()=>t.jsx(S.Selector,{onChange:ae,rowKey:e.data.metadata.key,selectedKeys:w}):void 0;return{index:e.index,data:e.data.data,metadata:e.data.metadata,selector:i}},[F,w,ae]),xe=e=>{const i=ye(e),o=null==me?void 0:me.get(i.metadata.key),r=n&&le(i.metadata.key),d=a===i.metadata.key&&!r,g=l.containsKey(w,i.metadata.key);return t.jsx(U,Object.assign({isFocused:d,isFocusRingVisible:ne&&!oe,isGridlineVisible:(b=i.index,"visible"===(null==u?void 0:u.item)&&(b+1!==(null==c?void 0:c.totalSize)||"visible"===(null==u?void 0:u.bottom))),isSelected:g,isTabbable:n&&le(i.metadata.key),itemIndex:i.index,itemKey:i.metadata.key,role:T,selectionMode:F,currentItemVariant:I},o&&{suggestion:o},0===i.index&&{isTopGridlineVisible:"visible"===(null==u?void 0:u.item)&&"visible"===(null==u?void 0:u.top)},{children:s(i)}),i.metadata.key);var b};R=Q(P,R);const he=K?t.jsx(j.VirtualizedCollection,Object.assign({data:c,itemSelector:_,loadMoreIndicator:te,onLoadRange:h,rangeExtractor:C,suggestions:fe,viewportConfig:R},{children:xe})):t.jsx(r.LoadMoreCollection,Object.assign({data:c,loadMoreIndicator:te,onLoadRange:h,suggestions:fe,viewportConfig:R},{children:xe})),pe=i.useCallback(e=>{const t=k.keyExtractor(e.target,_);l.isKeyDefined(t)&&(M.current=t)},[]);return t.jsx("div",Object.assign({},o.mergeProps(n?re:{},G,se,be,ve,{onFocus:ge,onPointerDown:pe}),{role:T,"aria-rowcount":q,"aria-colcount":1,ref:P,class:B,tabIndex:0,"aria-label":e,"aria-multiselectable":D},{children:null==c?d:he}))},e.SkeletonContainer=q});
//# sourceMappingURL=List-2e90b0fb.js.map
