{"version":3,"file":"VirtualizedCollection.spec.js","sources":["../../../../src/PRIVATE_VirtualizedCollection/__tests__/VirtualizedCollection.spec.tsx"],"sourcesContent":["import { useRef, useState } from 'preact/hooks';\nimport { render } from '@testing-library/preact';\nimport { expect } from 'chai';\nimport { DataState, ItemContext, Range, Metadata } from '../../UNSAFE_Collection';\nimport { VirtualizedCollection } from '../VirtualizedCollection';\n\ntype Employee = {\n  id: string;\n  name: string;\n};\n\ntype Props = {\n  data: { data: Employee; metadata: Metadata<string> }[];\n};\nfunction TestComponent({ data }: Props) {\n  const rootRef = useRef(null);\n  const [dataState, setDataState] = useState<DataState<string, Employee>>({\n    offset: 0,\n    data: data.slice(0, 25),\n    totalSize: data.length,\n    sizePrecision: 'exact'\n  });\n\n  const loadRange = (range: Range) => {\n    const startIndex = range.offset;\n    const endIndex = startIndex + range.count;\n    const newDataState = {\n      ...dataState,\n      offset: startIndex,\n      data: data.slice(startIndex, endIndex)\n    };\n    setDataState(newDataState);\n  };\n\n  const getConfig = () => {\n    return {\n      scroller: () => {\n        return rootRef.current;\n      }\n    };\n  };\n\n  return (\n    <div style=\"height: 200px;overflow: auto\" ref={rootRef}>\n      <VirtualizedCollection\n        data={dataState}\n        itemSelector=\".item\"\n        viewportConfig={getConfig()}\n        onLoadRange={loadRange}>\n        {(context: ItemContext<{ data: Employee; metadata: Metadata<string> }>) => (\n          <div\n            key={context.data.metadata.key}\n            className=\"item\"\n            style={{ height: '20px', padding: '0.75rem' }}>\n            {context.data.data.name}\n          </div>\n        )}\n      </VirtualizedCollection>\n    </div>\n  );\n}\n\nfunction populateData(count: number): Employee[] {\n  const data: Employee[] = [];\n  for (let i = 0; i < count; i++) {\n    data.push({ id: 'i' + i, name: 'Employee ' + i });\n  }\n  return data;\n}\n\ndescribe('Test VirtualizedCollection component', () => {\n  beforeEach(() => {\n    if (!window.IntersectionObserver) {\n      // IntersectionObserver isn't available in test environment\n      const MockIntersectionObserver = jest.fn();\n      MockIntersectionObserver.mockReturnValue({\n        observe: () => null,\n        unobserve: () => null,\n        disconnect: () => null\n      });\n\n      Object.defineProperty(global, 'IntersectionObserver', {\n        writable: true,\n        configurable: true,\n        value: MockIntersectionObserver\n      });\n    }\n  });\n\n  it('initial render', async function () {\n    const data = populateData(100);\n    const dataMetadata: { data: Employee; metadata: Metadata<string> }[] = data.map((data) => {\n      return { data: data, metadata: { key: data.id } };\n    });\n    const content = render(<TestComponent data={dataMetadata}></TestComponent>);\n    const emps = await content.queryAllByText('Employee', { exact: false });\n    expect(emps.length).eq(25);\n  });\n});\n"],"names":["TestComponent","data","rootRef","useRef","dataState","setDataState","useState","offset","slice","totalSize","length","sizePrecision","_jsx","jsx","Object","assign","style","ref","VirtualizedCollection","itemSelector","viewportConfig","scroller","current","onLoadRange","range","startIndex","endIndex","count","newDataState","children","context","className","height","padding","name","metadata","key","describe","beforeEach","window","IntersectionObserver","MockIntersectionObserver","jest","fn","mockReturnValue","observe","unobserve","disconnect","defineProperty","global","writable","configurable","value","it","async","dataMetadata","i","push","id","populateData","map","content","render","emps","queryAllByText","exact","expect","eq"],"mappings":"0SAcA,SAASA,GAAcC,KAAEA,IACvB,MAAMC,EAAUC,SAAO,OAChBC,EAAWC,GAAgBC,WAAsC,CACtEC,OAAQ,EACRN,KAAMA,EAAKO,MAAM,EAAG,IACpBC,UAAWR,EAAKS,OAChBC,cAAe,UAsBjB,OACEC,EAAAC,IAAA,MAAAC,OAAAC,OAAA,CAAKC,MAAM,+BAA+BC,IAAKf,aAC7CU,EAACC,IAAAK,EAAqBA,sBACpBJ,OAAAC,OAAA,CAAAd,KAAMG,EACNe,aAAa,QACbC,eAZG,CACLC,SAAU,IACDnB,EAAQoB,SAWfC,YAzBaC,IACjB,MAAMC,EAAaD,EAAMjB,OACnBmB,EAAWD,EAAaD,EAAMG,MAC9BC,EACDd,OAAAC,OAAAD,OAAAC,OAAA,GAAAX,IACHG,OAAQkB,EACRxB,KAAMA,EAAKO,MAAMiB,EAAYC,KAE/BrB,EAAauB,KAkBR,CAAAC,SAACC,GACAlB,EAEEC,IAAA,MAAAC,OAAAC,OAAA,CAAAgB,UAAU,OACVf,MAAO,CAAEgB,OAAQ,OAAQC,QAAS,sBACjCH,EAAQ7B,KAAKA,KAAKiC,OAHdJ,EAAQ7B,KAAKkC,SAASC,WAmBvCC,SAAS,uCAAwC,KAC/CC,WAAW,KACT,IAAKC,OAAOC,qBAAsB,CAEhC,MAAMC,EAA2BC,KAAKC,KACtCF,EAAyBG,gBAAgB,CACvCC,QAAS,IAAM,KACfC,UAAW,IAAM,KACjBC,WAAY,IAAM,OAGpBjC,OAAOkC,eAAeC,OAAQ,uBAAwB,CACpDC,UAAU,EACVC,cAAc,EACdC,MAAOX,OAKbY,GAAG,iBAAkBC,iBACnB,MACMC,EA7BV,SAAsB5B,GACpB,MAAM1B,EAAmB,GACzB,IAAK,IAAIuD,EAAI,EAAGA,EAAI7B,EAAO6B,IACzBvD,EAAKwD,KAAK,CAAEC,GAAI,IAAMF,EAAGtB,KAAM,YAAcsB,IAE/C,OAAOvD,EAuBQ0D,CAAa,KACkDC,IAAK3D,IACxE,CAAEA,KAAMA,EAAMkC,SAAU,CAAEC,IAAKnC,EAAKyD,OAEvCG,EAAUC,EAAMA,OAAClD,MAACZ,EAAc,CAAAC,KAAMsD,KACtCQ,QAAaF,EAAQG,eAAe,WAAY,CAAEC,OAAO,IAC/DC,EAAAA,OAAOH,EAAKrD,QAAQyD,GAAG"}