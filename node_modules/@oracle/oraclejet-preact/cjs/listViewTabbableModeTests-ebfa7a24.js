/* @oracle/oraclejet-preact: 14.1.0 */
'use strict';

var jsxRuntime = require('preact/jsx-runtime');
var preact = require('@testing-library/preact');
var chai = require('chai');
var userEvent = require('@testing-library/user-event');
var listViewTestFixtures = require('./listViewTestFixtures-eb39b1f7.js');
var testHelpers = require('./testHelpers-81b8b24e.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var userEvent__default = /*#__PURE__*/_interopDefaultLegacy(userEvent);

const testTabbableMode = (TestComponent) => {
    it('acts as single tab stop in composition', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByText('Preceding Button'));
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(grid);
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByText('Following Button'));
        userEvent__default["default"].tab({ shift: true });
        chai.expect(document.activeElement).equals(grid);
        userEvent__default["default"].tab({ shift: true });
        chai.expect(document.activeElement).equals(list.getByText('Preceding Button'));
    });
    it('enters interactive mode with keyboard via F2', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        // Tab past first button into ListView
        userEvent__default["default"].tab();
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(grid);
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        preact.fireEvent.keyUp(grid, { key: 'F2' });
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
    });
    it('enters and leaves interactive mode with keyboard via F2, ESC and arrow keys', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        // Tab past first button into ListView
        userEvent__default["default"].tab();
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(grid);
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        preact.fireEvent.keyUp(grid, { key: 'F2' });
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        preact.fireEvent.keyUp(grid, { key: 'Esc' });
        await preact.waitFor(() => {
            chai.expect(document.activeElement).equals(grid);
        });
        preact.fireEvent.keyDown(grid, { key: 'ArrowDown' });
        const secondRowInput = list.getByTestId('input-1');
        chai.expect(secondRowInput.getAttribute('tabindex')).equals('-1');
        preact.fireEvent.keyUp(grid, { key: 'F2' });
        chai.expect(secondRowInput.getAttribute('tabindex')).equals('0');
    });
    it('enters interactive mode with click on input', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        userEvent__default["default"].click(firstRowInput);
        // NOTE without this rerender the state change doesn't stick
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        chai.expect(document.activeElement).equals(firstRowInput);
        userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByTestId('button-0'));
    });
    // FIXME: reenable this test once https://jira.oraclecorp.com/jira/browse/JET-54037 is fixed
    xit('leaves interactive mode with click outside', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        userEvent__default["default"].click(firstRowInput);
        // NOTE without this rerender the state change doesn't stick
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        chai.expect(document.activeElement).equals(firstRowInput);
        const outsideElement = list.getByText('Preceding Button');
        userEvent__default["default"].click(outsideElement);
        chai.expect(document.activeElement).equals(outsideElement);
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
    });
};

exports.testTabbableMode = testTabbableMode;
/*  */
//# sourceMappingURL=listViewTabbableModeTests-ebfa7a24.js.map
