{"version":3,"file":"UNSAFE_Layer.js","sources":["../../src/UNSAFE_Layer/LayerContext.ts","../../src/UNSAFE_Layer/Layer.tsx","../../src/UNSAFE_Layer/LayerHost.tsx","../../src/UNSAFE_Layer/LayerManager.tsx"],"sourcesContent":["import { createContext } from 'preact';\n\nexport type LayerContextProps = {\n  getHost?: () => Element;\n};\n\nexport const LayerContext = createContext<LayerContextProps>({});\n","import { VNode, RefObject } from 'preact';\nimport { createPortal, useContext, useLayoutEffect, useMemo, useState } from 'preact/compat';\nimport { LayerContext } from './LayerContext';\n\nconst _LOGICAL_PARENT = '__oj_logical_parent';\n\ntype Props = {\n  /**\n   * The content to be re-parented using Portal\n   */\n  children: VNode;\n  /**\n   * Logical parent of the re-parented content. Typically the 'launcher' associated\n   * with the popup.\n   */\n  logicalParentRef?: RefObject<Element> | null;\n};\n\ntype LayerElement = HTMLDivElement & {\n  __oj_logical_parent?: Element | null;\n};\n\nconst Layer = (props: Props) => {\n  const context = useContext(LayerContext);\n  const defaultHost = context.getHost?.();\n  const host = useMemo(() => defaultHost, [defaultHost]);\n  const [layerContainer, setLayerContainer] = useState<Element | null>(null);\n\n  // Really need useLayoutEffect instead of useEffect here. Otherwise the re-parented\n  // content does not get re-rendered with valid ref's\n  useLayoutEffect(() => {\n    if (!host) return;\n    const doc = host.ownerDocument ?? document;\n    const layer: LayerElement = doc.createElement('div');\n\n    if (props.logicalParentRef) {\n      layer[_LOGICAL_PARENT] = props.logicalParentRef.current;\n    }\n\n    host.appendChild(layer);\n    setLayerContainer(layer);\n\n    return () => {\n      if (host && layer && host.contains(layer)) {\n        delete layer[_LOGICAL_PARENT];\n        host.removeChild(layer);\n      }\n      setLayerContainer(null);\n    };\n  }, [host]);\n\n  return layerContainer && createPortal(props.children, layerContainer);\n};\n\nexport default Layer;\n","/**\n * The LayerHost is a div which is created in place\n * where you want to \"house\" a portaled content\n */\nimport { forwardRef } from 'preact/compat';\n\nconst LayerHost = forwardRef<HTMLDivElement>((_props, ref) => {\n  return <div id=\"__oj_layerhost_container\" ref={ref} />;\n});\n\nLayerHost.displayName = 'Forwarded<LayerHost>';\n\nexport default LayerHost;\n","/**\n * The LayerManager wraps your application and creates two adjacent divs for\n * rendering your application and housing Layers.\n */\nimport { ComponentChildren } from 'preact';\nimport { useCallback, useState } from 'preact/compat';\nimport { LayerContext, LayerContextProps } from './LayerContext';\nimport LayerHost from './LayerHost';\n\ntype LayerManagerProps = {\n  children?: ComponentChildren;\n};\n\nexport function LayerManager({ children }: LayerManagerProps) {\n  const [defaultHost, setDefaultHost] = useState<Element>();\n  //const context = useContext(LayerContext);\n  const defaultHostRef = useCallback((el: Element | null) => {\n    // ref callbacks fire after the component has been unnmounted so we do not\n    // want to set state in this use-case\n    if (el !== null) {\n      setDefaultHost(el);\n    }\n  }, []);\n\n  return (\n    <LayerContext.Consumer>\n      {(value: LayerContextProps) => {\n        const defaultHostContext = defaultHost ? { getHost: () => defaultHost } : {};\n        const layerContext = value.getHost ? value : defaultHostContext;\n        return (\n          <LayerContext.Provider value={layerContext}>\n            {children}\n            {!value.getHost && <LayerHost ref={defaultHostRef} />}\n          </LayerContext.Provider>\n        );\n      }}\n    </LayerContext.Consumer>\n  );\n}\n"],"names":["createContext","useContext","useMemo","useState","useLayoutEffect","createPortal","forwardRef","_jsx","useCallback","_jsxs"],"mappings":"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"}