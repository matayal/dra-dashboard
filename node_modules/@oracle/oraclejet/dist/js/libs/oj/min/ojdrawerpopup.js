/**
 * @license
 * Copyright (c) 2014, 2023, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","preact/jsx-runtime","ojs/ojvcomponent","preact","jquery","ojs/ojanimation","ojs/ojdomutils","ojs/ojcore-base","ojs/ojpopup","ojs/ojdrawerutils","hammerjs"],function(e,t,s,r,o,n,i,a,l,d,p){"use strict";o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p;var h,c=function(e,t,s,r){var o,n=arguments.length,i=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,s,i):o(t,s))||i);return n>3&&i&&Object.defineProperty(t,s,i),i},u=function(e,t,s,r){return new(s||(s=Promise))(function(o,n){function i(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,a)}l((r=r.apply(e,t||[])).next())})};const w=oj,D=oj.PopupService,g=window,f=oj.ZOrderUtils;e.DrawerPopup=h=class extends r.Component{constructor(){super(...arguments),this.state={opened:this.props.opened,viewportResolvedDisplayMode:this.getViewportResolvedDisplayMode(),viewportResolvedDisplayModeVertical:this.getViewportResolvedDisplayModeVertical()},this.rootRef=r.createRef(),this.isShiftKeyActive=!1,this.drawerResizeHandler=null,this.windowResizeHandler=null,this.handleKeyDown=e=>{if(e.key===d.DrawerConstants.keys.ESC)return void this.selfClose();const t=d.DrawerUtils.getFocusables(this.rootRef.current);if(e.key===d.DrawerConstants.keys.TAB&&"modal"===this.props.modality){this.isShiftKeyActive=e.shiftKey;const{length:s,0:r,[s-1]:o}=t;if(!s)return e.preventDefault(),void this.rootRef.current.focus();if(e.shiftKey){if(document.activeElement===r)return e.preventDefault(),void o.focus()}else if(document.activeElement===o)return e.preventDefault(),void r.focus()}},this.autoDismissHandler=e=>{const t=d.DrawerUtils.getFocusables(this.rootRef.current),s=this.rootRef.current.parentNode,r=this.isTargetDescendantOfOwnZorderLayerOrItsNextSiblings(s,e.target);if("focus-loss"===this.props.autoDismiss){if("focus"===e.type&&"modal"===this.props.modality&&!r){e.preventDefault();const s=e.relatedTarget,r=t[0],o=t[t.length-1];return void(s===r?o.focus():r.focus())}r||this.selfClose()}else"none"!==this.props.autoDismiss||"modal"!==this.props.modality||r||e.preventDefault()},this.refreshHandler=e=>{const t=o(this.rootRef.current);t.position(this.getDrawerPosition(e)),D.getInstance().triggerOnDescendents(t,D.EVENT.POPUP_REFRESH)},this.destroyHandler=()=>{const e=o(this.rootRef.current);f.getStatus(e)===f.STATUS.OPEN&&f.removeFromAncestorLayer(e)},this.isTargetDescendantOfOwnZorderLayerOrItsNextSiblings=(e,t)=>{const s=[e];let r=e.nextSibling;for(;r;)s.push(r),r=r.nextSibling;return s.some(e=>e.contains(t))},this.windowResizeCallback=()=>{const e={},t=this.state.viewportResolvedDisplayMode,s=this.getViewportResolvedDisplayMode();t!==s&&(e.viewportResolvedDisplayMode=s);const r=this.state.viewportResolvedDisplayModeVertical,o=this.getViewportResolvedDisplayModeVertical();r!==o&&(e.viewportResolvedDisplayModeVertical=o),Object.keys(e).length>0&&this.setState(e)},this.handleSwipeAction=()=>{this.selfClose()}}static getDerivedStateFromProps(e,t){return e.opened!==t.opened?{opened:e.opened}:null}render(e){return this.isDrawerOpened()||this.wasDrawerOpenedInPrevState()?t.jsx(s.Root,Object.assign({ref:this.rootRef,class:this.getPopupStyleClasses(this.props.edge),tabIndex:-1,role:this.props.role||"dialog",onKeyDown:this.handleKeyDown},{children:t.jsx("div",Object.assign({class:"oj-drawer-full-height"},{children:e.children}))})):t.jsx(s.Root,{})}isDrawerOpened(){return this.state[d.DrawerConstants.stringOpened]}wasDrawerOpenedInPrevState(){return this.openedPrevState}selfClose(){var e,t,s,r;return u(this,void 0,void 0,function*(){try{yield null===(t=(e=this.props).onOjBeforeClose)||void 0===t?void 0:t.call(e)}catch(e){return}null===(r=(s=this.props).onOpenedChanged)||void 0===r||r.call(s,!1)})}openOrCloseDrawer(e){this.isDrawerOpened()!=e.opened&&(this.openedPrevState=this.isDrawerOpened());const t=o(this.rootRef.current),s=D.getInstance(),r=this.getPopupServiceOptions(e);this.isDrawerOpened()?[f.STATUS.CLOSE,f.STATUS.UNKNOWN].indexOf(f.getStatus(t)>-1)&&s.open(r):f.getStatus(t)===f.STATUS.OPEN&&s.close(r)}getPopupServiceOptions(e){const t=this.props.edge,s=o(this.rootRef.current),r={},n=D.OPTION;r[n.POPUP]=s,r[n.LAUNCHER]=o(document.activeElement),r[n.MODALITY]=this.props.modality,r[n.LAYER_SELECTORS]=this.getDrawerSurrogateLayerSelectors(),r[n.LAYER_LEVEL]=D.LAYER_LEVEL.TOP_LEVEL,r[n.POSITION]=this.getDrawerPosition(t),r[n.CUSTOM_ELEMENT]=!0;const i=D.EVENT;return r[n.EVENTS]={[i.POPUP_BEFORE_OPEN]:()=>this.beforeOpenHandler(t,r),[i.POPUP_AFTER_OPEN]:()=>this.afterOpenHandler(t,e),[i.POPUP_BEFORE_CLOSE]:()=>this.beforeCloseHandler(t),[i.POPUP_AFTER_CLOSE]:()=>this.afterCloseHandler(e),[i.POPUP_AUTODISMISS]:e=>this.autoDismissHandler(e),[i.POPUP_REFRESH]:()=>this.refreshHandler(t),[i.POPUP_REMOVE]:()=>this.destroyHandler()},r}beforeOpenHandler(e,t){d.DrawerUtils.disableBodyOverflow(),this.drawerOpener=document.activeElement;const s=t[D.OPTION.POPUP],r=t[D.OPTION.POSITION];s.show(),s.position(r);const o=w.Context.getContext(this.rootRef.current).getBusyContext().addBusyState({description:"Animation in progress"}),i=n.slideIn(this.rootRef.current,d.DrawerUtils.getAnimationOptions(d.DrawerConstants.stringSlideIn,e));return i.then(o),i}afterOpenHandler(e,t){d.DrawerUtils.enableBodyOverflow(),this.handleFocus(t);const s=o(this.rootRef.current),r=f.getStatus(s);if(null===this.drawerResizeHandler&&(this.drawerResizeHandler=this.drawerResizeCallback.bind(this,s,e)),i.addResizeListener(this.rootRef.current,this.drawerResizeHandler,0,!0),r===f.STATUS.OPEN&&!this.isDrawerOpened()){const e=D.getInstance(),s=this.getPopupServiceOptions(t);e.close(s)}}drawerResizeCallback(e,t){e.position(this.getDrawerPosition(t))}handleFocus(e){if(this.state.opened&&e.opened!==this.state.opened){const e=this.rootRef.current.querySelectorAll("[autofocus]"),{length:t,0:s}=e;if(t>0)return void s.focus({preventScroll:!0});const r=d.DrawerUtils.getFocusables(this.rootRef.current);let o=this.rootRef.current;r.length&&(o=r[0]),o.focus({preventScroll:!0})}}beforeCloseHandler(e){d.DrawerUtils.disableBodyOverflow(),this.elementWithFocusBeforeDrawerCloses=document.activeElement,i.removeResizeListener(this.rootRef.current,this.drawerResizeHandler),this.drawerResizeHandler=null;const t=w.Context.getContext(this.rootRef.current).getBusyContext().addBusyState({description:"Animation in progress"}),s=n.slideOut(this.rootRef.current,d.DrawerUtils.getAnimationOptions(d.DrawerConstants.stringSlideOut,e));return s.then(t),s}afterCloseHandler(e){d.DrawerUtils.enableBodyOverflow();const t=o(this.rootRef.current),s=f.getStatus(t);if(this.rootRef.current.contains(this.elementWithFocusBeforeDrawerCloses)&&d.DrawerUtils.moveFocusToElementOrNearestAncestor(this.drawerOpener),s===f.STATUS.CLOSE&&this.isDrawerOpened()){const t=D.getInstance(),s=this.getPopupServiceOptions(e);t.open(s)}else this.wasDrawerOpenedInPrevState()||this.forceUpdate()}getDrawerSurrogateLayerSelectors(){let e=d.DrawerConstants.DrawerPopupStyleSurrogate;return"modal"===this.props.modality&&(e+=` ${d.DrawerConstants.stringOjDrawer}${d.DrawerConstants.charDash}modal`),e}getDrawerPosition(e){let t=`${e} ${"bottom"===e?"bottom":"top"}`,s={my:t,at:t,of:window,collision:"none"};return oj.PositionUtils.normalizeHorizontalAlignment(s,d.DrawerUtils.isRTL())}getPopupStyleClasses(e){const t={};return e===d.DrawerConstants.stringBottom?this.getViewportResolvedDisplayModeVertical()!==d.DrawerConstants.stringFullOverlay&&this.getViewportResolvedDisplayMode()!==d.DrawerConstants.stringFullOverlay||(t[d.DrawerConstants.styleDisplayMode(d.DrawerConstants.stringFullOverlay)]=!0):this.getViewportResolvedDisplayMode()===d.DrawerConstants.stringFullOverlay&&(t[d.DrawerConstants.styleDisplayMode(d.DrawerConstants.stringFullOverlay)]=!0),d.DrawerUtils.getStyleClassesMapAsString(Object.assign(t,d.DrawerUtils.getCommonStyleClasses(e)))}componentDidUpdate(e,t){this.handleComponentUpdate(t)}componentDidMount(){if(null===this.windowResizeHandler&&(this.windowResizeHandler=this.windowResizeCallback.bind(this)),window.addEventListener(d.DrawerConstants.stringResize,this.windowResizeHandler),this.openedPrevState=this.props.opened,h.defaultProps.opened!=this.props.opened){const e=Object.assign({},this.state);e.opened=!1,this.handleComponentUpdate(e)}}componentWillUnmount(){window.removeEventListener(d.DrawerConstants.stringResize,this.windowResizeHandler),this.windowResizeHandler=null}getViewportResolvedDisplayMode(){return d.DrawerUtils.getViewportWidth()>=d.DrawerConstants.fullWidthDrawerChangeThreshold?d.DrawerConstants.stringOverlay:d.DrawerConstants.stringFullOverlay}getViewportResolvedDisplayModeVertical(){return d.DrawerUtils.getViewportHeight()>=d.DrawerConstants.fullHeightDrawerChangeThreshold?d.DrawerConstants.stringOverlay:d.DrawerConstants.stringFullOverlay}handleComponentUpdate(e){this.openOrCloseDrawer(e),this.isDrawerOpened()&&"swipe"===this.props.closeGesture&&this.registerCloseWithSwipeListener(),!1===this.isDrawerOpened()&&e.opened&&this.unregisterCloseWithSwipeListener()}registerCloseWithSwipeListener(){this.hammerInstance=new p(g),this.props.edge===d.DrawerConstants.stringBottom&&this.hammerInstance.get("swipe").set({direction:p.DIRECTION_DOWN}),this.hammerInstance.on(this.getSwipeCloseDirection(this.props.edge),this.handleSwipeAction)}getSwipeCloseDirection(e){switch(e){case d.DrawerConstants.stringStart:return d.DrawerUtils.isRTL()?"swiperight":"swipeleft";case d.DrawerConstants.stringEnd:return d.DrawerUtils.isRTL()?"swipeleft":"swiperight";case d.DrawerConstants.stringBottom:return"swipedown"}}unregisterCloseWithSwipeListener(){this.hammerInstance&&this.hammerInstance.off(this.getSwipeCloseDirection(this.props.edge),this.handleSwipeAction)}},e.DrawerPopup.defaultProps={autoDismiss:"focus-loss",edge:"start",modality:"modal",opened:!1,closeGesture:"swipe"},e.DrawerPopup._metadata={slots:{"":{}},properties:{opened:{type:"boolean",writeback:!0},edge:{type:"string",enumValues:["end","start","bottom"]},modality:{type:"string",enumValues:["modal","modeless"]},autoDismiss:{type:"string",enumValues:["none","focus-loss"]},closeGesture:{type:"string",enumValues:["none","swipe"]}},events:{ojBeforeClose:{cancelable:!0}},extension:{_WRITEBACK_PROPS:["opened"],_READ_ONLY_PROPS:[],_OBSERVED_GLOBAL_PROPS:["role"]}},e.DrawerPopup=h=c([s.customElement("oj-drawer-popup")],e.DrawerPopup),Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojdrawerpopup.js.map